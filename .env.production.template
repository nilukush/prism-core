# PRISM Production Environment Configuration Template
# Copy this file to .env.production and fill in all values
# NEVER commit the actual .env.production file to version control

# ============================================================================
# CRITICAL SECURITY VALUES - Generate unique values for each environment
# ============================================================================

# Generate with: openssl rand -base64 32
SECRET_KEY=CHANGE_ME_GENERATE_UNIQUE_VALUE
JWT_SECRET_KEY=${SECRET_KEY}
ENCRYPTION_KEY=CHANGE_ME_GENERATE_UNIQUE_VALUE
NEXTAUTH_SECRET=CHANGE_ME_GENERATE_UNIQUE_VALUE

# Database credentials - Use strong passwords
DATABASE_URL=postgresql+asyncpg://prism_user:CHANGE_ME@postgres:5432/prism_prod
POSTGRES_USER=prism_user
POSTGRES_PASSWORD=CHANGE_ME
POSTGRES_DB=prism_prod

# Redis credentials - Use strong password
REDIS_URL=redis://:CHANGE_ME@redis:6379/0
REDIS_PASSWORD=CHANGE_ME

# ============================================================================
# APPLICATION CONFIGURATION
# ============================================================================

# Application settings
APP_NAME=PRISM
APP_VERSION=0.1.0
APP_ENV=production
NODE_ENV=production
API_PREFIX=/api/v1
ENVIRONMENT=production

# URLs - Update with your actual domains
FRONTEND_URL=https://app.yourdomain.com
BACKEND_URL=https://api.yourdomain.com
NEXT_PUBLIC_API_URL=https://api.yourdomain.com
NEXT_PUBLIC_APP_URL=https://app.yourdomain.com
NEXT_PUBLIC_APP_DOMAIN=yourdomain.com

# CORS - Add all allowed origins
CORS_ORIGINS=["https://app.yourdomain.com"]
BACKEND_CORS_ORIGINS=["https://app.yourdomain.com"]

# ============================================================================
# SESSION MANAGEMENT
# ============================================================================

# Session TTLs (in seconds)
SESSION_TTL=604800              # 7 days
TOKEN_FAMILY_TTL=2592000        # 30 days
BLACKLIST_TTL=604800            # 7 days
ACCESS_TOKEN_TTL=1800           # 30 minutes
REFRESH_TOKEN_TTL=604800        # 7 days
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# Session security
SESSION_ID_BYTES=32             # 256 bits
SESSION_BINDING_ENABLED=true
SESSION_BINDING_SECRET_BYTES=32
TOKEN_ROTATION_ENABLED=true
TOKEN_REUSE_WINDOW=10           # seconds
TOKEN_FAMILY_MAX_HISTORY=20

# Redis configuration
REDIS_POOL_SIZE=10
REDIS_LOCK_TTL=30               # seconds
REDIS_RETRY_MAX=5
REDIS_RETRY_DELAY=1
REDIS_RETRY_BACKOFF=2.0

# Cleanup settings
SESSION_CLEANUP_INTERVAL=3600   # 1 hour
SESSION_CLEANUP_BATCH_SIZE=1000

# ============================================================================
# RATE LIMITING
# ============================================================================

# General rate limits
RATE_LIMIT_ENABLED=true
RATE_LIMIT_STRATEGY=token_bucket
RATE_LIMIT_PER_SECOND=10
RATE_LIMIT_PER_MINUTE=100
RATE_LIMIT_PER_HOUR=1000
RATE_LIMIT_PER_DAY=10000
RATE_LIMIT_BURST=20
RATE_LIMIT_BLOCK_DURATION=3600  # 1 hour

# Auth endpoint rate limits (stricter)
RATE_LIMIT_AUTH_PER_SECOND=2
RATE_LIMIT_AUTH_PER_MINUTE=10
RATE_LIMIT_AUTH_PER_HOUR=100
RATE_LIMIT_AUTH_PER_DAY=500
RATE_LIMIT_AUTH_BURST=5

# AI endpoint rate limits (most restrictive)
RATE_LIMIT_AI_PER_SECOND=1
RATE_LIMIT_AI_PER_MINUTE=5
RATE_LIMIT_AI_PER_HOUR=50
RATE_LIMIT_AI_PER_DAY=200
RATE_LIMIT_AI_BURST=3

# Public endpoint rate limits (more permissive)
RATE_LIMIT_PUBLIC_PER_SECOND=20
RATE_LIMIT_PUBLIC_PER_MINUTE=200
RATE_LIMIT_PUBLIC_PER_HOUR=2000
RATE_LIMIT_PUBLIC_PER_DAY=20000
RATE_LIMIT_PUBLIC_BURST=50

# DDoS Protection
DDOS_PROTECTION_ENABLED=true
DDOS_MAX_CONNECTIONS_PER_IP=100
DDOS_BLACKLIST_DURATION=3600    # 1 hour
DDOS_CHALLENGE_ENABLED=true

# ============================================================================
# SECURITY HEADERS
# ============================================================================

# Content Security Policy
CSP_SCRIPT_SRC='self' 'nonce-{nonce}'
CSP_STYLE_SRC='self' 'nonce-{nonce}' https://fonts.googleapis.com
CSP_FONT_SRC='self' https://fonts.gstatic.com data:
CSP_IMG_SRC='self' data: https: blob:
CSP_CONNECT_SRC='self' https://api.openai.com https://api.anthropic.com
CSP_MEDIA_SRC='self'
CSP_OBJECT_SRC='none'
CSP_FRAME_ANCESTORS='none'
CSP_BASE_URI='self'
CSP_FORM_ACTION='self'

# HSTS Configuration
HSTS_MAX_AGE=63072000           # 2 years
HSTS_INCLUDE_SUBDOMAINS=true
HSTS_PRELOAD=true

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================

DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=40
DATABASE_POOL_TIMEOUT=30

# ============================================================================
# EMAIL CONFIGURATION
# ============================================================================

EMAIL_ENABLED=true
SMTP_HOST=smtp.sendgrid.net
SMTP_PORT=587
SMTP_USERNAME=apikey
SMTP_PASSWORD=CHANGE_ME_SENDGRID_API_KEY
SMTP_FROM_EMAIL=noreply@yourdomain.com
SMTP_FROM_NAME=PRISM
SUPPORT_EMAIL=support@yourdomain.com

# Email settings
EMAIL_VERIFICATION_REQUIRED=true
EMAIL_VERIFICATION_EXPIRE=86400  # 24 hours
PASSWORD_RESET_EXPIRE=3600       # 1 hour
EMAIL_WELCOME_ENABLED=true
EMAIL_DAILY_DIGEST_ENABLED=false
EMAIL_WEEKLY_REPORT_ENABLED=true
EMAIL_RATE_LIMIT_PER_HOUR=10
EMAIL_BATCH_SIZE=50
EMAIL_RETRY_ATTEMPTS=3
EMAIL_RETRY_DELAY=60

# ============================================================================
# AI SERVICES
# ============================================================================

# OpenAI
OPENAI_API_KEY=CHANGE_ME_IF_USING_OPENAI
OPENAI_ORG_ID=
OPENAI_API_BASE=https://api.openai.com/v1
DEFAULT_LLM_MODEL=gpt-3.5-turbo
LLM_TEMPERATURE=0.7
LLM_MAX_TOKENS=2000
LLM_REQUEST_TIMEOUT=30

# Anthropic
ANTHROPIC_API_KEY=CHANGE_ME_IF_USING_ANTHROPIC

# ============================================================================
# MONITORING
# ============================================================================

# Sentry
SENTRY_DSN=https://xxx@sentry.io/xxx
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1

# OpenTelemetry
OTEL_ENABLED=true
OTEL_SERVICE_NAME=prism-backend
OTEL_EXPORTER_OTLP_ENDPOINT=https://otel-collector.yourdomain.com:4317

# Prometheus
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090

# ============================================================================
# LOGGING
# ============================================================================

LOG_LEVEL=INFO
LOG_FORMAT=json
LOG_FILE_PATH=/var/log/prism/prism.log
LOG_FILE_ROTATION=daily
LOG_FILE_RETENTION=30           # days

# ============================================================================
# STORAGE
# ============================================================================

STORAGE_BACKEND=s3              # local or s3
STORAGE_LOCAL_PATH=/data/uploads

# AWS S3 (if using S3)
AWS_ACCESS_KEY_ID=CHANGE_ME_IF_USING_S3
AWS_SECRET_ACCESS_KEY=CHANGE_ME_IF_USING_S3
AWS_S3_BUCKET=prism-uploads
AWS_S3_REGION=us-east-1
AWS_S3_ENDPOINT_URL=            # For S3-compatible services

# ============================================================================
# FEATURE FLAGS
# ============================================================================

FEATURE_ANALYTICS_ENABLED=true
FEATURE_MARKETPLACE_ENABLED=false
FEATURE_ENTERPRISE_SSO_ENABLED=true
FEATURE_MULTI_TENANCY_ENABLED=true
USE_PERSISTENT_SESSIONS=true

# ============================================================================
# CACHE CONFIGURATION
# ============================================================================

CACHE_TTL_DEFAULT=300           # 5 minutes
CACHE_TTL_DOCUMENTS=3600        # 1 hour
CACHE_TTL_ANALYTICS=1800        # 30 minutes

# ============================================================================
# AUDIT CONFIGURATION
# ============================================================================

AUDIT_ENABLED=true
AUDIT_RETENTION_DAYS=90

# ============================================================================
# CELERY CONFIGURATION
# ============================================================================

CELERY_BROKER_URL=redis://:${REDIS_PASSWORD}@redis:6379/1
CELERY_RESULT_BACKEND=redis://:${REDIS_PASSWORD}@redis:6379/2
CELERY_TIMEZONE=UTC
CELERY_TASK_DEFAULT_QUEUE=default
CELERY_TASK_DEFAULT_PRIORITY=5
CELERY_TASK_MAX_RETRIES=3
CELERY_TASK_RETRY_DELAY=60

# ============================================================================
# QDRANT VECTOR DATABASE
# ============================================================================

QDRANT_URL=http://qdrant:6333
QDRANT_API_KEY=CHANGE_ME_IF_USING_QDRANT
QDRANT_COLLECTION_NAME=prism_documents
QDRANT_USE_CLOUD=false

# ============================================================================
# OAUTH CONFIGURATION
# ============================================================================

# Google OAuth
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=

# GitHub OAuth
GITHUB_CLIENT_ID=
GITHUB_CLIENT_SECRET=

# Microsoft OAuth
MICROSOFT_CLIENT_ID=
MICROSOFT_CLIENT_SECRET=

# ============================================================================
# FRONTEND CONFIGURATION
# ============================================================================

# API Configuration
NEXT_PUBLIC_API_TIMEOUT=30000
NEXT_PUBLIC_API_UPLOAD_TIMEOUT=300000
NEXT_PUBLIC_API_DOWNLOAD_TIMEOUT=300000
NEXT_PUBLIC_API_RETRY_ATTEMPTS=3
NEXT_PUBLIC_API_RETRY_DELAY=1000

# OAuth Configuration
NEXT_PUBLIC_OAUTH_GRANT_TYPE=password
NEXT_PUBLIC_OAUTH_CLIENT_ID=
NEXT_PUBLIC_OAUTH_SCOPE=openid profile email

# Token Configuration
NEXT_PUBLIC_ACCESS_TOKEN_EXPIRY=1800      # 30 minutes
NEXT_PUBLIC_REFRESH_TOKEN_EXPIRY=2592000  # 30 days
NEXT_PUBLIC_TOKEN_REFRESH_BUFFER=300      # 5 minutes
NEXT_PUBLIC_SESSION_MAX_AGE=2592000       # 30 days
NEXT_PUBLIC_SESSION_UPDATE_AGE=86400      # 24 hours

# Cookie Configuration
NEXT_PUBLIC_COOKIE_SAME_SITE=lax
NEXT_PUBLIC_COOKIE_DOMAIN=.yourdomain.com
NEXT_PUBLIC_COOKIE_PATH=/

# ============================================================================
# WEBHOOK CONFIGURATION
# ============================================================================

WEBHOOK_SECRET=CHANGE_ME_GENERATE_UNIQUE_VALUE
GITHUB_WEBHOOK_SECRET=
SLACK_WEBHOOK_URL=
SLACK_SIGNING_SECRET=

# ============================================================================
# MISCELLANEOUS
# ============================================================================

# Timezone
TZ=UTC

# Locale
LANG=en_US.UTF-8
LC_ALL=en_US.UTF-8

# Python
PYTHONUNBUFFERED=1
PYTHONDONTWRITEBYTECODE=1

# Node.js
NODE_OPTIONS=--max-old-space-size=4096